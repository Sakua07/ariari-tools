<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>ğŸ†ã‚¿ã‚°ç·é¸æŒ™ğŸ†</title>
<style>
  body {
    font-family: "Hiragino Maru Gothic ProN", sans-serif;
    background: linear-gradient(180deg, #fffafc, #ffe4ef);
    text-align: center;
    padding: 20px;
  }
  h1 {
    color: #b33;
    text-shadow: 1px 1px 2px #fff;
  }

  .sakura-section {
    background: rgba(255, 230, 240, 0.8);
    border: 2px solid #ff99bb;
    border-radius: 10px;
    padding: 10px;
    margin-bottom: 15px;
    box-shadow: 0 2px 6px rgba(255,150,180,0.3);
  }
  .sakura-section h2 {
    color: #e55a91;
    margin: 0;
  }

  .howto {
    font-size: 14px;
    color: #b33;
    background: rgba(255,245,250,0.8);
    border: 1px solid #ffb6c1;
    border-radius: 8px;
    padding: 8px;
    margin-bottom: 10px;
    display: inline-block;
  }

  /* â–¼ ã“ã“ã«ä½¿ã„æ–¹è¿½è¨˜æ¸ˆï¼ˆğŸ¦Xã¸ãƒã‚¹ãƒˆã®èª¬æ˜ï¼‰ â–¼ */

  #themeInput {
    padding: 6px 10px;
    border-radius: 6px;
    border: 1px solid #b33;
    font-size: 16px;
    margin-bottom: 10px;
  }
  #themeTitle {
    font-size: 22px;
    color: #b33;
    font-weight: bold;
    margin: 15px 0;
  }

  #controls {
    margin: 20px auto;
  }
  input[type="text"] {
    padding: 5px;
    border-radius: 6px;
    border: 1px solid #b33;
    margin: 3px;
  }
  button {
    padding: 8px 12px;
    border-radius: 8px;
    border: none;
    background-color: #b33;
    color: #fff;
    font-weight: bold;
    cursor: pointer;
  }
  button:hover {
    background-color: #d44;
  }

  #pyramid {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 20px auto;
    position: relative;
  }
  .row {
    display: flex;
    justify-content: center;
    margin: 5px 0;
  }
  .block {
    background: #ffb380;
    border: 2px solid #b33;
    color: #fff;
    font-weight: bold;
    padding: 10px 15px 75px;
    margin: 3px;
    border-radius: 8px;
    box-shadow: 0 3px 5px rgba(0,0,0,0.2);
    min-width: 140px;
    position: relative;
  }
  .block span {
    display: block;
    font-size: 14px;
  }

  .rank-label {
    font-weight: bold;
    color: #b33;
    margin-bottom: 3px;
  }

  .edit-area {
    position: absolute;
    bottom: 10px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
    width: calc(100% - 20px);
  }
  .edit-area .row-input {
    display: flex;
    gap: 6px;
    align-items: center;
    justify-content: center;
    width: 100%;
  }
  .edit-area input[type="number"], .edit-area input[type="text"] {
    width: 60px;
    padding: 4px;
    border-radius: 4px;
    border: 1px solid #b33;
    font-size: 12px;
    text-align: center;
    background: #fff;
    color: #000;
  }
  .edit-area .small-btn {
    padding: 4px 8px;
    font-size: 12px;
    border-radius: 6px;
    background-color: #e55a91;
    color: #fff;
    border: none;
    cursor: pointer;
  }

  .name-edit-btn {
    position: absolute;
    top: 6px;
    right: 6px;
    background: #e55a91;
    color: #fff;
    font-size: 12px;
    padding: 2px 8px;
    border-radius: 6px;
    border: none;
    cursor: pointer;
  }

  .modal {
    display: none;
    position: fixed;
    z-index: 10;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(255, 240, 245, 0.85);
    justify-content: center;
    align-items: center;
  }
  .modal-content {
    background: #fff;
    border: 2px solid #ff99bb;
    border-radius: 10px;
    padding: 20px;
    width: 85%;
    max-width: 350px;
    text-align: center;
  }
  .modal-content input {
    width: 90%;
    padding: 8px;
    font-size: 16px;
    margin-bottom: 10px;
  }

  #pyramidImg {
    position: absolute;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    z-index: -1;
    opacity: 0.15;
    width: 90%;
  }

  #backupFileInput {
    display: none;
  }

</style>
</head>
<body>

<div class="sakura-section">
  <h2>ğŸŒ¸#ã‚¢ãƒªã‚¢ãƒªãƒ„ãƒ¼ãƒ«ğŸŒ¸</h2>
</div>

<div class="howto">
  ğŸŒ¸ä½¿ã„æ–¹ï¼šãƒ†ãƒ¼ãƒå…¥åŠ›â†’é …ç›®è¿½åŠ â†’ptç·¨é›†â†’ç·¨é›†ã§åå‰ç·¨é›†ï¼<br>
  âœ¨ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¯JSONã§ä¿å­˜ãƒ»èª­ã¿è¾¼ã¿ã§ãã¾ã™<br>
  ğŸ¦Xã¸ãƒã‚¹ãƒˆï¼šæŠ¼ã™ã¨ç”»åƒè‡ªå‹•DLï¼‹æŠ•ç¨¿ç”»é¢ãŒé–‹ãã‚ˆï¼
</div>

<h1>ğŸ†#ã‚¿ã‚°ç·é¸æŒ™ãƒ”ãƒ©ãƒŸãƒƒãƒ‰ï¼ğŸ†</h1>

<input id="themeInput" type="text" placeholder="ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ†ãƒ¼ãƒã‚’å…¥åŠ›ï¼ˆä¾‹ï¼šå¥½ããªãƒ‰ãƒªãƒ³ã‚¯ï¼‰" oninput="updateTheme()">
<div id="themeTitle">ãƒ†ãƒ¼ãƒæœªè¨­å®šãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼</div>

<div id="controls">
  <input id="itemInput" type="text" placeholder="é …ç›®åã‚’å…¥åŠ›">
  <button onclick="addItem()">è¿½åŠ </button>

  <button onclick="share()">ğŸ“¤å…±æœ‰</button>

  <!-- Xã¸ãƒã‚¹ãƒˆ -->
  <button onclick="postToX()">ğŸ¦Xã¸ãƒã‚¹ãƒˆ</button>

  <button onclick="downloadBackup()">ğŸ’¾ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä¿å­˜</button>
  <button onclick="triggerBackupUpload()">ğŸ“‚ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å¾©å…ƒ</button>
  <input id="backupFileInput" type="file" accept=".json" onchange="handleBackupUpload(event)">
</div>

<div id="pyramid">
  <img id="pyramidImg" src="https://cdn.pixabay.com/photo/2016/09/10/17/18/pyramid-1651631_1280.png" alt="pyramid">
</div>

<div id="nameModal" class="modal">
  <div class="modal-content">
    <h3>åå‰ã‚’ç·¨é›†</h3>
    <input type="text" id="editNameInput" placeholder="æ–°ã—ã„åå‰ã‚’å…¥åŠ›">
    <br>
    <button onclick="saveName()">æ±ºå®š</button>
    <button onclick="closeNameModal()" style="margin-left:8px;background:#b33;">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
  </div>
</div>

<div id="welcomeModal" class="modal">
  <div class="modal-content">
    <p>
      #ã‚¢ãƒªã‚¢ãƒªãƒ„ãƒ¼ãƒ«ã¸ã‚ˆã†ã“ãï¼<br>
      å…ƒãƒã‚¹ãƒˆã‚’ã„ã„ã­ã¨ãƒªãƒ„ã§å¿œæ´ã—ã¦ã‹ã‚‰ä½¿ã£ã¦ã­ï¼<br>
      ãŸãã•ã‚“ã®æ–¹ãŒæ¥½ã—ã‚“ã§ãã‚ŒãŸã‚‰å¬‰ã—ã„( Ë¶>á´—<Ë¶)â™ª<br>
      ã˜ã‚ƒãªã„ã¨ã•ãã‚‰ã‚¢ãƒªãŒæ‹—ã­ã¡ã‚ƒã†ã‚ˆww
    </p>
    <button onclick="closeModal()">é–‰ã˜ã‚‹</button>
    <button onclick="goToPost()">å…ƒãƒã‚¹ãƒˆã¸é£›ã¶</button>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script>
let items = []; 
let editingIndex = null;
let theme = "";

/* â–¼ åˆæœŸåŒ–ï¼š6å€‹ã®ç©ºé …ç›® */
window.addEventListener("DOMContentLoaded", () => {
  for(let i=1; i<=6; i++){
    items.push({ name: `é …ç›®${i}`, points: 0 });
  }
  renderPyramid();
});

function updateTheme(){
  theme = document.getElementById("themeInput").value.trim();
  document.getElementById("themeTitle").textContent =
    theme ? `${theme}ãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼` : "ãƒ†ãƒ¼ãƒæœªè¨­å®šãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼";
}

function renderPyramid(){
  const pyramid = document.getElementById("pyramid");
  Array.from(pyramid.children).forEach(child=>{
    if(child.id === 'pyramidImg') return;
    pyramid.removeChild(child);
  });

  if(items.length === 0) return;

  const sorted = [...items].map((v,i)=>({...v, index:i})).sort((a,b)=>b.points - a.points);
  let idx=0, rowCount=1;
  const ranks=["ğŸ¥‡1ä½âœ¨","ğŸ¥ˆ2ä½","ğŸ¥‰3ä½","4ä½","5ä½","6ä½","7ä½","8ä½","9ä½","10ä½"];

  while(idx < sorted.length){
    const rankLabel = document.createElement("div");
    rankLabel.className = "rank-label";
    rankLabel.textContent = ranks[rowCount-1] || `${rowCount}ä½`;
    pyramid.appendChild(rankLabel);

    const rowDiv = document.createElement("div");
    rowDiv.className = "row";

    for(let i=0;i<rowCount && idx<sorted.length;i++){
      const p = sorted[idx];
      const block = document.createElement("div");
      block.className = "block";
      block.innerHTML = `
        ${escapeHtml(p.name)}
        <span>${p.points}pt</span>
      `;

      const editBtn = document.createElement("button");
      editBtn.className = "name-edit-btn";
      editBtn.textContent = "ç·¨é›†";
      editBtn.onclick = (ev) => {
        ev.stopPropagation();
        editingIndex = p.index;
        document.getElementById("editNameInput").value = p.name;
        document.getElementById("nameModal").style.display = "flex";
      };
      block.appendChild(editBtn);

      const editArea = document.createElement("div");
      editArea.className = "edit-area";

      const rowOverwrite = document.createElement("div");
      rowOverwrite.className = "row-input";

      const overwriteLabel = document.createElement("div");
      overwriteLabel.textContent = "pt";
      overwriteLabel.style.fontSize = "12px";
      overwriteLabel.style.color = "#fff";

      const overwriteInput = document.createElement("input");
      overwriteInput.type = "number";
      overwriteInput.value = p.points;

      const overwriteBtn = document.createElement("button");
      overwriteBtn.className = "small-btn";
      overwriteBtn.textContent = "æ±ºå®š";
      overwriteBtn.onclick = (ev) => {
        ev.stopPropagation();
        const val = parseInt(overwriteInput.value);
        if (isNaN(val) || val < 0) return alert("æ­£ã—ã„æ•°å€¤ã‚’å…¥åŠ›ã—ã¦ã­ï¼");
        items[p.index].points = val;
        renderPyramid();
      };

      rowOverwrite.appendChild(overwriteLabel);
      rowOverwrite.appendChild(overwriteInput);
      rowOverwrite.appendChild(overwriteBtn);

      const rowAdd = document.createElement("div");
      rowAdd.className = "row-input";

      const addLabel = document.createElement("div");
      addLabel.textContent = "ptè¿½åŠ ";
      addLabel.style.fontSize = "12px";
      addLabel.style.color = "#fff";

      const addInput = document.createElement("input");
      addInput.type = "number";
      addInput.value = 0;

      const addBtn = document.createElement("button");
      addBtn.className = "small-btn";
      addBtn.textContent = "æ±ºå®š";
      addBtn.onclick = (ev) => {
        ev.stopPropagation();
        const val = parseInt(addInput.value);
        if (isNaN(val)) return alert("æ­£ã—ã„æ•°å€¤ã‚’å…¥åŠ›ã—ã¦ã­ï¼");
        items[p.index].points += val;
        renderPyramid();
      };

      rowAdd.appendChild(addLabel);
      rowAdd.appendChild(addInput);
      rowAdd.appendChild(addBtn);

      editArea.appendChild(rowOverwrite);
      editArea.appendChild(rowAdd);
      block.appendChild(editArea);

      rowDiv.appendChild(block);
      idx++;
    }
    pyramid.appendChild(rowDiv);
    rowCount++;
  }
}

function addItem(){
  const name = document.getElementById("itemInput").value.trim();
  if(!name) return alert("é …ç›®åã‚’å…¥åŠ›ã—ã¦ã­ï¼");
  items.push({ name, points: 0 });
  document.getElementById("itemInput").value = "";
  renderPyramid();
}

function saveName(){
  const newName = document.getElementById("editNameInput").value.trim();
  if(!newName) return alert("åå‰ã‚’å…¥åŠ›ã—ã¦ã­ï¼");
  items[editingIndex].name = newName;
  document.getElementById("nameModal").style.display = "none";
  renderPyramid();
}
function closeNameModal(){
  document.getElementById("nameModal").style.display = "none";
}

async function share(){
  const pyramid = document.getElementById("pyramid");
  const canvas = await html2canvas(pyramid, { scale: 2, backgroundColor: null });
  canvas.toBlob(async (blob) => {
    const file = new File([blob], "ranking-pyramid.png", { type: "image/png" });
    if(navigator.share){
      await navigator.share({
        title: `${theme || "ã¿ã‚“ãªã®"}ãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼`,
        text: `#ã‚¢ãƒªã‚¢ãƒªãƒ„ãƒ¼ãƒ« #${theme || "ã¿ã‚“ãªã®"}ãƒ©ãƒ³ã‚­ãƒ³ã‚° é€”ä¸­çµæœ`,
        files: [file]
      });
    } else {
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "ranking-pyramid.png";
      a.click();
    }
  });
}

/* â–¼â–¼â–¼ PCå¯¾å¿œç‰ˆï¼šXã¸ãƒã‚¹ãƒˆ â–¼â–¼â–¼ */
async function postToX(){
  try {
    const sorted = [...items].sort((a,b)=>b.points - a.points);
    if(sorted.length < 3){
      alert("3ä½ã¾ã§é …ç›®ã‚’ä½œã£ã¦ã­ï¼");
      return;
    }

    const t1 = sorted[0];
    const t2 = sorted[1];
    const t3 = sorted[2];

    const text =
`ğŸ¥‡ ${t1.name}  ${t1.points}pt
ğŸ¥ˆ ${t2.name}  ${t2.points}pt
ğŸ¥‰ ${t3.name}  ${t3.points}pt
#IRIAM #ã‚¢ãƒªã‚¢ãƒªãƒ„ãƒ¼ãƒ«`;

    /* â–¼ ç”»åƒã‚­ãƒ£ãƒ—ãƒãƒ£ï¼†è‡ªå‹•DL */
    const pyramid = document.getElementById("pyramid");
    const canvas = await html2canvas(pyramid, { scale: 2, backgroundColor: null });
    const blob = await new Promise(resolve => canvas.toBlob(resolve));
    const url = URL.createObjectURL(blob);

    const a = document.createElement("a");
    a.href = url;
    a.download = "ranking-pyramid.png";
    a.click();

    /* â–¼ XæŠ•ç¨¿ç”»é¢ã‚’é–‹ãï¼ˆPCå¯¾å¿œï¼‰ */
    const tweetUrl =
      "https://twitter.com/intent/tweet?text=" +
      encodeURIComponent(text);

    window.open(tweetUrl, "_blank");

  } catch(err){
    console.error(err);
    alert("æŠ•ç¨¿ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ");
  }
}
/* â–²â–²â–² ã“ã“ã¾ã§ Xãƒã‚¹ãƒˆ â–²â–²â–² */

function downloadBackup(){
  const data = { theme, items };
  const json = JSON.stringify(data, null, 2);
  const blob = new Blob([json], { type: "application/json" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = `ranking-backup-${new Date().toISOString().slice(0,19).replace(/:/g,"-")}.json`;
  a.click();
  URL.revokeObjectURL(url);
}

function triggerBackupUpload(){
  document.getElementById("backupFileInput").value = "";
  document.getElementById("backupFileInput").click();
}

function handleBackupUpload(e){
  const file = e.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = (ev) => {
    try {
      const parsed = JSON.parse(ev.target.result);
      if(!parsed || !Array.isArray(parsed.items)) throw new Error("ä¸æ­£ãªãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã§ã™");
      items = parsed.items.map(it=>({ name: it.name, points: it.points }));
      theme = parsed.theme || "";
      document.getElementById("themeInput").value = theme;
      document.getElementById("themeTitle").textContent =
        theme ? `${theme}ãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼` : "ãƒ†ãƒ¼ãƒæœªè¨­å®šãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼";
      renderPyramid();
      alert("ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å¾©å…ƒã—ã¾ã—ãŸï¼");
    } catch(err) {
      alert("å¾©å…ƒã«å¤±æ•—ã—ã¾ã—ãŸï¼š " + err.message);
    }
  };
  reader.readAsText(file);
}

window.onload = () => {
  document.getElementById("welcomeModal").style.display = "flex";
};
function closeModal(){
  document.getElementById("welcomeModal").style.display = "none";
}
function goToPost(){
  window.open("https://twitter.com/your_post_url", "_blank");
}

function escapeHtml(str){
  return String(str).replace(/[&<>"']/g, s => ({
    '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"
  }[s]));
}
function goToPost(){
  window.open(
    "https://x.com/ari_sakura_x/status/1993226275025306019",
    "_blank"
  );
}


</script>
</body>
</html>
