<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ğŸŒ¸ æ¢±åŒ…ã‚¬ãƒãƒ£ãƒ„ãƒ¼ãƒ«ï¼</title>
<style>
  body{background:#fff0f5;color:#333;font-family:system-ui,"Noto Sans JP",sans-serif;margin:0;padding:16px}
  h1{margin:0 0 8px;}
  .card{background:#ffe4f0;border:1px solid #ffb6c1;border-radius:14px;padding:14px;margin-bottom:12px}
  input,select,button{font-size:15px}
  input[type="text"],input[type="number"],select{
    width:100%;max-width:250px;padding:6px 8px;
    border-radius:8px;border:1px solid #ffb6c1;background:#fff;color:#333;margin-bottom:8px
  }
  input::placeholder{color:#aaa}
  button{border:0;border-radius:8px;padding:8px 12px;background:#ff69b4;color:#fff;font-weight:700;cursor:pointer}
  button.secondary{background:#ffb6c1;color:#fff}
  button:disabled{opacity:.6;cursor:not-allowed}
  .pill{padding:2px 6px;border-radius:999px;font-weight:700;font-size:13px}
  .N{background:#ddd;color:#555}
  .R{background:#d0f0d0;color:#228b22}
  .SR{background:#d0e0ff;color:#1e90ff}
  .SSR{background:#f0d0ff;color:#ba55d3}
  .UR{background:#ffe4b5;color:#ff8c00}
  .LR{background:#ffc0cb;color:#b22222}
  .results, .history-list{display:grid;gap:8px}
  .item{background:#fff;border:1px solid #ffb6c1;border-radius:10px;padding:6px 8px;display:flex;gap:8px;align-items:center;justify-content:space-between}
  .msg{font-size:15px;flex:1;text-align:center}
  .count{color:#aaa;font-size:14px}
  .flex-row{display:flex;gap:8px;align-items:center;margin-bottom:8px}
  .flex-row > *{flex:1}
  .repost-btn{background:#ff69b4;color:#fff;font-weight:700;border-radius:8px;padding:4px 8px;cursor:pointer;}
  #alertModal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);display:flex;align-items:center;justify-content:center;z-index:999;display:none;}
  #alertContent{background:#ffe4f0;padding:20px;border-radius:14px;text-align:center;max-width:320px;max-height:80%;overflow-y:auto;}
  #alertContent p{margin-bottom:16px;}
  #closeAlertBtn{background:#ff69b4;color:#fff;font-weight:700;border-radius:8px;padding:6px 8px;margin-top:8px;cursor:pointer;}
</style>
</head>
<body>

<div class="card" id="welcomeCard">
  <p>ã‚¢ãƒªã‚¢ãƒªãƒ„ãƒ¼ãƒ«ã¸ã‚ˆã†ã“ãï¼<br>
  ã„ã„ã­ã¨ãƒªãƒã‚¹ãƒˆã§å¿œæ´ã—ã¦ã­ï¼<br>
  ã˜ã‚ƒãªã„ã¨ã•ãã‚‰ã‚¢ãƒªãŒæ‹—ã­ã¡ã‚ƒã†ã‚ˆ</p>
  <button class="repost-btn" id="welcomeRepostBtn">ãƒªãƒã‚¹ãƒˆã™ã‚‹</button>
</div>
<h5>ğŸŒ¸ å›°ã£ãŸæ™‚ã¯ã‚¢ãƒªã®æ‰‹ã‚‚å€Ÿã‚ŠãŸã„ã€œğŸœ</h5>
<h1>ğŸŒ¸ URLä¿å­˜æ©Ÿèƒ½ä»˜ãã‚¬ãƒãƒ£ãƒ„ãƒ¼ãƒ«ï¼</h1>
<h5>ğŸã‚¬ãƒãƒ£ã®ä¸­èº«ã‚’å…¥ã‚Œã¦è¿½åŠ ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸã‚‰ä¿å­˜ã•ã‚Œã‚‹ã‚ˆï¼</h5>
<h5>ğŸå±¥æ­´ã§äººã‚’é¸ã‚“ã§â†’ä¸€è¦§è¡¨ç¤ºâ†’ã‚³ãƒ”ãƒ¼ã§è¨­å®šã—ãŸURLãŒã‚³ãƒ”ãƒ¼ï¼çµæœæ¬„ã«ã¯è¡¨ç¤ºã•ã‚Œãªã„ã‚ˆï¼</h5>
<h5>ğŸã‚¬ãƒãƒ£ã‚’å¼•ã„ãŸå¾Œã«URLã‚’å…¥ã‚Œã¦ã‚‚ã‚‚ã†ä¸€åº¦ä¸€è¦§è¡¨ç¤ºãƒœã‚¿ãƒ³ã‚’æŠ¼ã›ã°å±¥æ­´ã‚³ãƒ”ãƒ¼ã«åæ˜ ã•ã‚Œã‚‹ã‚ˆï¼</h5>

<div class="card">
  <h2>ã‚¬ãƒãƒ£å†…å®¹è¿½åŠ </h2>
  <div class="flex-row">
    <select id="addRarity">
      <option value="N">N</option>
      <option value="R">R</option>
      <option value="SR">SR</option>
      <option value="SSR">SSR</option>
      <option value="UR">UR</option>
      <option value="LR">LR</option>
    </select>
    <input id="addText" type="text" placeholder="ã‚¬ãƒãƒ£å†…å®¹" />
    <input id="addLink" type="text" placeholder="ãƒªãƒ³ã‚¯ï¼ˆXã«ã¯å…±æœ‰ã—ã¾ã›ã‚“ï¼‰" />
    <button id="addBtn">è¿½åŠ </button>
  </div>
  <div class="flex-row">
    <label>ç¢ºç‡ï¼ˆNã¯è‡ªå‹•è¨ˆç®—ï¼‰</label>
    <input id="probR" type="number" min="0" max="100" value="10"/> R
    <input id="probSR" type="number" min="0" max="100" value="5"/> SR
    <input id="probSSR" type="number" min="0" max="100" value="2"/> SSR
    <input id="probUR" type="number" min="0" max="100" value="1"/> UR
    <input id="probLR" type="number" min="0" max="100" value="0.1"/> LR
  </div>
  <div class="flex-row">
    <button id="showItemsBtn" class="secondary">ã‚¬ãƒãƒ£å†…å®¹ä¸€è¦§è¡¨ç¤º</button>
    <button id="resetBtn" class="secondary">ãƒªã‚»ãƒƒãƒˆ</button>
    <button id="backupBtn" class="secondary">ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—</button>
    <button id="importBtn" class="secondary">ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
  </div>
</div>
<div class="card">
  <h2>ã‚¬ãƒãƒ£å®Ÿè¡Œ</h2>
  <div class="flex-row">
    <input id="playerName" type="text" placeholder="å¼•ãäººã®åå‰" />
    <select id="nameSelect"><option value="">é¸æŠ</option></select>
    <input id="times" type="number" min="1" max="1000" placeholder="å›æ•°ã‚’å…¥åŠ›"/>
    <button id="rollBtn" style="flex:2;font-size:18px">å›ã™</button>
  </div>
  <div class="flex-row">
    <button id="roll1">1å›</button>
    <button id="roll10">10å›</button>
    <button id="clearBtn" class="secondary">çµæœãƒªã‚»ãƒƒãƒˆ</button>
    <button id="saveImageBtn" style="background:#ffb6c1">ç”»åƒã‚’ä¿å­˜</button>
    <button id="shareBtn" style="background:#1d9bf0">Xã§å…±æœ‰</button>
    <button id="saveTextBtn" style="background:#ff69b4">æ–‡ç« ä¿å­˜</button>
  </div>
</div>
<div class="card">
  <h2>çµæœï¼ˆæ–°ã—ã„é †ï¼ç›´è¿‘ã®ã¿ï¼‰</h2>
  <div id="results" class="results"></div>
</div>
<div class="card">
  <h2>å±¥æ­´ï¼ˆã¾ã¨ã‚è¡¨ç¤ºï¼‰</h2>
  <div class="flex-row">
    <select id="historyFilter"><option value="">å…¨å“¡</option></select>
    <button id="showHistoryBtn">ä¸€è¦§è¡¨ç¤º</button>
    <button id="copyAllBtn">ã‚³ãƒ”ãƒ¼</button>
  </div>
  <div id="history" class="history-list"></div>
</div>
<div id="alertModal">
  <div id="alertContent">
    <p id="alertMessage">ã‚¢ãƒªã‚¢ãƒªãƒ„ãƒ¼ãƒ«ã¸ã‚ˆã†ã“ãï¼</p>
    <div id="alertItems"></div>
    <button id="closeAlertBtn">é–‰ã˜ã‚‹</button>
  </div>
</div>
<script>
/* ---------------------------------------------------------
   IndexedDB ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
   --------------------------------------------------------- */
let db;
const DB_NAME = "gachaDB";
const STORE_NAME = "gachaStore";
function openDB() {
  return new Promise((resolve, reject) => {
    const req = indexedDB.open(DB_NAME, 1);
    req.onerror = e => reject(e);
    req.onsuccess = e => {
      db = e.target.result;
      resolve(db);
    };
    req.onupgradeneeded = e => {
      const db = e.target.result;
      if (!db.objectStoreNames.contains(STORE_NAME)) {
        db.createObjectStore(STORE_NAME, { keyPath: "key" });
      }
    };
  });
}
function saveToDB(key, value) {
  return new Promise((resolve, reject) => {
    const tx = db.transaction(STORE_NAME, "readwrite");
    const store = tx.objectStore(STORE_NAME);
    store.put({ key, value });
    tx.oncomplete = resolve;
    tx.onerror = reject;
  });
}
function loadFromDB(key) {
  return new Promise((resolve, reject) => {
    const tx = db.transaction(STORE_NAME, "readonly");
    const store = tx.objectStore(STORE_NAME);
    const req = store.get(key);
    req.onsuccess = () => resolve(req.result ? req.result.value : null);
    req.onerror = reject;
  });
}
/* ---------------------------------------------------------
   ï¼ˆ DB åŒ–ï¼‰
   --------------------------------------------------------- */
let ITEMS = [], history = [], playerNames = [], historyPlayers = [];
const historyEl = document.getElementById("history");
/* DB ã‹ã‚‰èª­ã¿è¾¼ã¿ */
async function loadData() {
  await openDB();
  ITEMS = (await loadFromDB("gacha_ITEMS")) || [];
  history = (await loadFromDB("gacha_history")) || [];
  playerNames = (await loadFromDB("gacha_playerNames")) || [];
  historyPlayers = (await loadFromDB("gacha_historyPlayers")) || [];
  playerNames.forEach(n => {
    let o = document.createElement("option");
    o.value = n; o.textContent = n;
    nameSelect.appendChild(o);
  });
  historyPlayers.forEach(n => {
    let o = document.createElement("option");
    o.value = n; o.textContent = n;
    historyFilter.appendChild(o);
  });
  if (history.length > 0) showHistory();
}
/* ãƒ‡ãƒ¼ã‚¿ãƒªã‚»ãƒƒãƒˆ */
async function resetData() {
  if (confirm("ã‚¬ãƒãƒ£å†…å®¹ãƒ»å±¥æ­´ã‚’ã™ã¹ã¦ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ")) {
    ITEMS = []; history = []; playerNames = []; historyPlayers = [];
    await saveToDB("gacha_ITEMS", ITEMS);
    await saveToDB("gacha_history", history);
    await saveToDB("gacha_playerNames", playerNames);
    await saveToDB("gacha_historyPlayers", historyPlayers);
    nameSelect.innerHTML='<option value="">é¸æŠ</option>';
    historyFilter.innerHTML='<option value="">å…¨å“¡</option>';
    results.innerHTML=""; historyEl.innerHTML="";
    alert("ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸï¼");
  }
}
resetBtn.onclick = resetData;
window.addEventListener('load', async () => {
  alertModal.style.display='flex';
  alertMessage.innerHTML="ã‚¢ãƒªã‚¢ãƒªãƒ„ãƒ¼ãƒ«ã¸ã‚ˆã†ã“ãï¼<br>ã„ã„ã­ã¨ãƒªãƒã‚¹ãƒˆã§å¿œæ´ã—ã¦ã­ï¼";
  await loadData();
});
closeAlertBtn.onclick = ()=>{alertModal.style.display='none';};
/* â–  ã‚¬ãƒãƒ£å†…å®¹è¿½åŠ ï¼ˆDB ä¿å­˜ï¼‰ */
addBtn.onclick = async () => {
  let rarity = addRarity.value,
      text = addText.value.trim(),
      link = addLink.value.trim();
  if (!text) { alert("å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"); return; }
  ITEMS.push({ rarity, text, link });
  await saveToDB("gacha_ITEMS", ITEMS);
  addText.value = ""; addLink.value = ""; addRarity.value = "N";
  alert("è¿½åŠ ã—ã¾ã—ãŸï¼ï¼ˆIndexedDB ã«ä¿å­˜æ¸ˆï¼‰");
};
/* ä»¥ä¸‹ã€æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã¯å‹•ä½œå¤‰æ›´ãªã—ï¼ˆä¿å­˜éƒ¨åˆ†ã®ã¿ DB åŒ–ï¼‰ */
function renderItemsInAlert(){
  alertItems.innerHTML="";
  if(ITEMS.length===0){alertItems.innerHTML="<p>ã‚¬ãƒãƒ£å†…å®¹ãŒã‚ã‚Šã¾ã›ã‚“</p>";}
  else ITEMS.forEach((it,i)=>{
    let div=document.createElement("div");
    div.className="item";
    div.innerHTML=`<span class="pill ${it.rarity}">${it.rarity}</span>
      <span class="msg">${it.text}${it.link?' ('+it.link+')':''}</span>
      <button onclick="editItem(${i})">ç·¨é›†</button>
      <button onclick="deleteItem(${i})">å‰Šé™¤</button>`;
    alertItems.appendChild(div);
  });
  alertModal.style.display="flex";
}
showItemsBtn.onclick=()=>{renderItemsInAlert();};
async function editItem(i){
  let it=ITEMS[i],r=prompt("ãƒ¬ã‚¢åº¦:",it.rarity);if(r===null)return;
  r=r.toUpperCase();if(!["N","R","SR","SSR","UR","LR"].includes(r)){alert("ç„¡åŠ¹ãªãƒ¬ã‚¢åº¦");return;}
  let t=prompt("å†…å®¹:",it.text);if(t===null)return;
  let l=prompt("ãƒªãƒ³ã‚¯:",it.link);if(l===null)return;
  ITEMS[i]={rarity:r,text:t.trim(),link:l.trim()};
  await saveToDB("gacha_ITEMS", ITEMS);
  renderItemsInAlert();
}
async function deleteItem(i){
  if(confirm("å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")){
    ITEMS.splice(i,1);
    await saveToDB("gacha_ITEMS", ITEMS);
    renderItemsInAlert();
  }
}
/* åå‰ç™»éŒ²é–¢é€£ã‚‚ DB ä¿å­˜ */
playerName.addEventListener('change', async ()=>{
  let val=playerName.value.trim();
  if(val&&!playerNames.includes(val)&&playerNames.length<30){
    playerNames.push(val);
    let o=document.createElement('option');
    o.value=val;o.textContent=val;
    nameSelect.appendChild(o);
  }
  if(val&&!historyPlayers.includes(val)){
    historyPlayers.push(val);
    let o=document.createElement('option');
    o.value=val;o.textContent=val;
    historyFilter.appendChild(o);
  }
  await saveToDB("gacha_playerNames", playerNames);
  await saveToDB("gacha_historyPlayers", historyPlayers);
});
nameSelect.addEventListener('change',()=>{
  playerName.value=nameSelect.value;
  historyFilter.value=nameSelect.value;
  showHistory();
});
/* ã‚¬ãƒãƒ£å‡¦ç†ï¼ˆå…ƒã®ã¾ã¾ï¼‰ */
function buildProbTable(){
  let pr=parseFloat(probR.value)||0,psr=parseFloat(probSR.value)||0,
      pssr=parseFloat(probSSR.value)||0,pur=parseFloat(probUR.value)||0,
      plr=parseFloat(probLR.value)||0;
  let sum=pr+psr+pssr+pur+plr;
  return {N:100-sum,R:pr,SR:psr,SSR:pssr,UR:pur,LR:plr};
}
function rollOnce(){
  if(ITEMS.length===0) return null; // alertã¯å‰Šé™¤ã—ã¦å˜ç´”ã« null ã‚’è¿”ã™
  let p=buildProbTable(),rand=Math.random()*100,acc=0,r="N";
  for(let k of ["R","SR","SSR","UR","LR","N"]){acc+=p[k];if(rand<acc){r=k;break;}}
  let c=ITEMS.filter(it=>it.rarity===r);if(c.length===0)c=ITEMS;
  return c[Math.floor(Math.random()*c.length)];
}
function roll(times){
  if(ITEMS.length === 0) { 
    alert("ã‚¬ãƒãƒ£å†…å®¹ãŒã‚ã‚Šã¾ã›ã‚“"); 
    return; // ITEMSãŒç©ºãªã‚‰ä¸€å›ã ã‘ã‚¢ãƒ©ãƒ¼ãƒˆã‚’å‡ºã—ã¦å‡¦ç†ä¸­æ­¢
  }
  let name=playerName.value.trim()||"åç„¡ã—",arr=[];
  for(let i=0;i<times;i++){
    let r=rollOnce(); 
    if(r) arr.push(r);
  }
  showResults(name,arr);
  addHistory(name,arr);
}
function showResults(name,arr){
  results.innerHTML="";
  let counts={};
  arr.forEach(r=>{counts[r.text+"|"+(r.link||"")]=(counts[r.text+"|"+(r.link||"")]|0)+1;});
  let text=name+"\n";
  for(let k in counts){
    let [t]=k.split("|");
    text+="ãƒ»"+t+(counts[k]>1?" Ã—"+counts[k]:"")+"\n";
  }
  text+="#ã‚¢ãƒªã‚¢ãƒªãƒ„ãƒ¼ãƒ«";
  let div=document.createElement("div");
  div.className="item";
  div.innerHTML=`<span class="msg">${text.replace(/\n/g,"<br>")}</span>`;
  results.append(div);
}
/* å±¥æ­´è¿½åŠ ï¼ˆDB ä¿å­˜ï¼‰ */
async function addHistory(name,arr){
  arr.forEach(r=>{history.unshift({name,rarity:r.rarity,text:r.text});});
  await saveToDB("gacha_history", history);
}
function showHistory(){
  let f=historyFilter.value;
  historyEl.innerHTML="";
  let grouped={};
  history.forEach(h=>{
    if(!f||h.name===f){
      let key=h.name+"|"+h.text;
      grouped[key]=(grouped[key]||0)+1;
    }
  });
  Object.keys(grouped).forEach(k=>{
    let [name,text]=k.split("|");
    let found=ITEMS.find(it=>it.text===text);
    let link=found?found.link:"";
    let div=document.createElement("div");
    div.className="item";
    div.innerHTML=`<span class="msg">${name}<br>ãƒ»${text}${grouped[k]>1?" Ã—"+grouped[k]:""}${link?"<br><small>URL: "+link+"</small>":""}</span>`;
    historyEl.appendChild(div);
  });
}
showHistoryBtn.onclick=showHistory;
/* ã‚³ãƒ”ãƒ¼ãƒœã‚¿ãƒ³ï¼ˆå¤‰æ›´ãªã—ï¼‰ */
copyAllBtn.onclick=()=>{
  const filter=historyFilter.value;
  let grouped={};
  history.forEach(h=>{
    if(!filter||h.name===filter){
      let key=h.name+"|"+h.text;
      grouped[key]=(grouped[key]||0)+1;
    }
  });
  let text="";
  Object.entries(grouped).forEach(([k,c])=>{
    let [n,t]=k.split("|");
    let found=ITEMS.find(it=>it.text===t);
    let l=found?found.link:"";
    text+=`${n}\nãƒ»${t}${c>1?" Ã—"+c:""}${l?`\n  URL: ${l}`:""}\n`;
  });
  if(!text){alert("ã‚³ãƒ”ãƒ¼å¯¾è±¡ãŒã‚ã‚Šã¾ã›ã‚“");return;}
  navigator.clipboard.writeText(text).then(()=>alert("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼ï¼ˆæœ€æ–°URLã‚‚åæ˜ æ¸ˆï¼‰"));
};
clearBtn.onclick=()=>{results.innerHTML="";};
rollBtn.onclick=()=>{let n=parseInt(times.value)||1;roll(n);};
roll1.onclick=()=>roll(1);
roll10.onclick=()=>roll(10);
welcomeRepostBtn.onclick = () => {
  window.open("https://x.com/ari_sakura_x/status/1980462132320956496?s=61", "_blank");
};
/* ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ»ã‚¤ãƒ³ãƒãƒ¼ãƒˆï¼ˆå…ƒã®ã¾ã¾ï¼‰ */
backupBtn.onclick = () => {
  const data = {
    ITEMS,
    history,
    playerNames,
    historyPlayers
  };
  const blob = new Blob([JSON.stringify(data, null, 2)], {type: "application/json"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "gacha_backup_" + new Date().toISOString().slice(0,19).replace(/[:T]/g,"-") + ".json";
  a.click();
  URL.revokeObjectURL(url);
  alert("ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸï¼");
};
importBtn.onclick = () => {
  const input = document.createElement("input");
  input.type = "file";
  input.accept = "application/json";
  input.onchange = async e => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = async () => {
      try {
        const data = JSON.parse(reader.result);
        if (confirm("ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¸Šæ›¸ãã—ã¦ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã™ã‹ï¼Ÿ")) {
          ITEMS = data.ITEMS || [];
          history = data.history || [];
          playerNames = data.playerNames || [];
          historyPlayers = data.historyPlayers || [];
          await saveToDB("gacha_ITEMS", ITEMS);
          await saveToDB("gacha_history", history);
          await saveToDB("gacha_playerNames", playerNames);
          await saveToDB("gacha_historyPlayers", historyPlayers);
          alert("ã‚¤ãƒ³ãƒãƒ¼ãƒˆãŒå®Œäº†ã—ã¾ã—ãŸï¼ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¾ã™ã€‚");
          location.reload();
        }
      } catch (err) {
        alert("ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ•ã‚¡ã‚¤ãƒ«ãŒæ­£ã—ã„å½¢å¼ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
      }
    };
    reader.readAsText(file);
  };
  input.click();
};
/* ç”»åƒä¿å­˜ï¼ˆå…ƒã®ã¾ã¾ï¼‰ */
saveImageBtn.onclick = async () => {
  if (typeof html2canvas === "undefined") {
    const script = document.createElement("script");
    script.src = "https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js";
    document.body.appendChild(script);
    script.onload = () => saveImageBtn.click();
    return;
  }

  // â†ã“ã“ã‹ã‚‰å¤‰æ›´
  const target = document.getElementById("results");      // body â†’ results
  target.style.padding = "20px";                          // ä¸€æ™‚çš„ã«ä½™ç™½ç¢ºä¿
  const canvas = await html2canvas(target, { scale: 2, backgroundColor: null });
  target.style.padding = "";                               // å…ƒã«æˆ»ã™
  // â†ã“ã“ã¾ã§å¤‰æ›´

  const link = document.createElement("a");
  link.download = "gacha_result_" + new Date().toISOString().slice(0,19).replace(/[:T]/g,"-") + ".png";
  link.href = canvas.toDataURL("image/png");
  link.click();
  alert("ç”»åƒã‚’ä¿å­˜ã—ã¾ã—ãŸï¼");
};
/* Xå…±æœ‰ï¼ˆå…ƒï¼‰ */
shareBtn.onclick = () => {
  const latest = document.querySelector("#results .item .msg");
  if (!latest) { alert("å…±æœ‰ã™ã‚‹çµæœãŒã‚ã‚Šã¾ã›ã‚“"); return; }
  const text = latest.innerText + "\n#IRIAM";
  const encoded = encodeURIComponent(text);
  const url = "https://x.com/intent/tweet?text=" + encoded;
  window.open(url, "_blank");
};
/* ãƒ†ã‚­ã‚¹ãƒˆä¿å­˜ï¼ˆå…ƒï¼‰ */
saveTextBtn.onclick = () => {
  const latest = document.querySelector("#results .item .msg");
  if (!latest) { alert("ã‚³ãƒ”ãƒ¼ã™ã‚‹æ–‡ç« ãŒã‚ã‚Šã¾ã›ã‚“"); return; }
  const text = latest.innerText;
  navigator.clipboard.writeText(text)
    .then(() => alert("æ–‡ç« ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼"))
    .catch(() => alert("ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ"));
};
</script>
</body>
</html>

