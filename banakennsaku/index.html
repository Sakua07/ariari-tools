<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ãƒãƒŠã‚¤ãƒ™é–‹å‚¬æ¤œç´¢ï¼†æ—©è¦‹è¡¨</title>
<style>
body{
  font-family:"Hiragino Sans","Meiryo",sans-serif;
  background:#fff7fb;
  padding:20px;
  text-align:center;
}
h1{ margin:20px 0; color:#d63384; }

.box{
  background:white;
  padding:20px;
  border-radius:15px;
  box-shadow:0 5px 15px rgba(0,0,0,0.1);
  margin-bottom:25px;
}

button{
  padding:6px 14px;
  border:none;
  border-radius:8px;
  background:#ff66a3;
  color:white;
  cursor:pointer;
}
button:hover{ background:#ff3385; }

select{
  padding:6px 10px;
  border-radius:8px;
  border:1px solid #ccc;
  margin-left:10px;
}

.year-nav{ font-size:20px; margin-bottom:10px; }

.result{
  margin-top:15px;
  font-weight:bold;
  color:#c2185b;
}

table{
  margin:20px auto;
  border-collapse:collapse;
  width:100%;
  max-width:1000px;
}
th,td{
  border:1px solid #ddd;
  padding:8px;
}
th{ background:#ffe0f0; }

.section-title{
  font-size:18px;
  margin-top:30px;
  color:#b03060;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.note{
  font-size:13px;
  color:#666;
}

.search-title{
  font-size:24px;
  font-weight:bold;
  color:#b03060;
  margin:10px 0 12px 0;
}

.example{
  font-size:12px;
  color:#888;
  margin-top:6px;
  line-height:1.6;
}
</style>
</head>
<body>

<div class="box">

  <div class="note">
  â€»åˆå‰4:00ã‚ˆã‚Šå‰ã«é…ä¿¡é–‹å§‹ã—ãŸå ´åˆã¯ã€Œå‰æ—¥æ‰±ã„ã€ã«ãªã‚Šã¾ã™
  </div>

  <div class="example">
  ä¾‹â‘ ï¼š2æœˆ22æ—¥ 3:00é–‹å§‹ â†’ 2æœˆ21æ—¥æ‰±ã„<br>
  ä¾‹â‘¡ï¼š2æœˆ22æ—¥ 6:00é–‹å§‹ â†’ 2æœˆ22æ—¥æ‰±ã„
  </div>

  <br>

<div class="search-title">
ğŸŒ¸ ãƒ‡ãƒ“ãƒ¥ãƒ¼æ—¥æ¤œç´¢
</div>


<input type="date" id="debutDateTime">
<button onclick="searchEvent()">æ¤œç´¢</button>
<div class="result" id="result"></div>

</div>

<div class="year-nav">
<button onclick="changeYear(-1)">â—€</button>
<span id="displayYear"></span>å¹´
<button onclick="changeYear(1)">â–¶</button>
</div>

<h1>ãƒˆãƒƒãƒ—ãƒãƒŠãƒ¼ãƒãƒ£ãƒ¬ãƒ³ã‚¸é–‹å‚¬æ—©è¦‹è¡¨</h1>

<div id="tables"></div>

<script>
let currentYear = new Date().getFullYear();
let currentHalf = "first";
let selectedMonth = "all";

function init(){
updateYearDisplay();
setDefaultDateTime();
generateTables();
}

function updateYearDisplay(){
document.getElementById("displayYear").innerText=currentYear;
}

function setDefaultDateTime(){
let d=new Date(currentYear,0,1);
document.getElementById("debutDateTime").value=d.toISOString().slice(0,10);
}

function changeYear(diff){
currentYear+=diff;
updateYearDisplay();
setDefaultDateTime();
generateTables();
document.getElementById("result").innerHTML="";
}

function changeHalf(value){
currentHalf=value;
selectedMonth="all";
generateTables();
}

function changeMonth(value){
selectedMonth=value;
generateTables();
}

function isLeapYear(y){
return (y%4===0 && y%100!==0) || y%400===0;
}

function firstTuesday(year,month){
let d=new Date(year,month-1,1);
while(d.getDay()!==2){
d.setDate(d.getDate()+1);
}
return d;
}

function formatDate(d){
return (d.getMonth()+1)+"/"+d.getDate();
}

function getDebutRanges(year,month){
let days = new Date(year,month,0).getDate();
let leap = isLeapYear(year);

if([1,3,5,7,8,10,12].includes(month)){
return [[1,8],[9,16],[17,24],[25,days]];
}

if([4,6,9,11].includes(month)){
return [[1,8],[9,16],[17,23],[24,days]];
}

if(month===2){
if(leap){
return [[1,9],[10,16],[17,23],[24,days]];
}
return [[1,8],[9,15],[16,22],[23,days]];
}
}

function generateTables(){

let container=document.getElementById("tables");
container.innerHTML="";

let startMonth = currentHalf==="first"?1:7;
let endMonth   = currentHalf==="first"?6:12;
let halfLabel  = currentHalf==="first"?"å‰åŠï¼ˆ1ã€œ6æœˆãƒ‡ãƒ“ãƒ¥ãƒ¼ï¼‰":"å¾ŒåŠï¼ˆ7ã€œ12æœˆãƒ‡ãƒ“ãƒ¥ãƒ¼ï¼‰";

let controls = `
<div>
<button onclick="changeHalf('first')">å‰åŠ</button>
<button onclick="changeHalf('second')">å¾ŒåŠ</button>
<select onchange="changeMonth(this.value)">
<option value="all">å…¨æœˆè¡¨ç¤º</option>
${Array.from({length:12},(_,i)=>`<option value="${i+1}">${i+1}æœˆ</option>`).join("")}
</select>
</div>
`;

let html=`<div class="section-title">
${currentYear}å¹´ ${halfLabel}
${controls}
</div>`;

html+=`<table>
<tr>
<th>åˆé…ä¿¡æ—¥æ™‚</th>
<th>å‚åŠ å¯èƒ½é€±</th>
<th>é–‹å‚¬æœŸé–“</th>
</tr>`;

for(let m=startMonth; m<=endMonth; m++){

if(selectedMonth!=="all" && parseInt(selectedMonth)!==m) continue;

let ranges=getDebutRanges(currentYear,m);
let nextMonth=m+1;
let eventYear=currentYear;
if(nextMonth===13){nextMonth=1;eventYear++;}

let firstTue=firstTuesday(eventYear,nextMonth);

ranges.forEach((r,i)=>{

let start=new Date(firstTue);
start.setDate(start.getDate()+i*7);
let end=new Date(start);
end.setDate(end.getDate()+6);

html+=`<tr>
<td>${m}æœˆ${r[0]}æ—¥ 4:00 ï½ ${m}æœˆ${r[1]}æ—¥ 3:59</td>
<td>${nextMonth}æœˆ${i+1}é€±ç›®</td>
<td>${formatDate(start)}ã€œ${formatDate(end)}</td>
</tr>`;
});
}

html+="</table>";
container.innerHTML=html;
}

function searchEvent(){

let input=document.getElementById("debutDateTime").value;
if(!input) return;

let debut=new Date(input);

let y=debut.getFullYear();
let m=debut.getMonth()+1;
let d=debut.getDate();

let ranges=getDebutRanges(y,m);

let week=1;
ranges.forEach((r,i)=>{
if(d>=r[0] && d<=r[1]){
week=i+1;
}
});

let nextMonth=m+1;
let eventYear=y;
if(nextMonth===13){nextMonth=1;eventYear++;}

let firstTue=firstTuesday(eventYear,nextMonth);

let start=new Date(firstTue);
start.setDate(start.getDate()+(week-1)*7);
let end=new Date(start);
end.setDate(end.getDate()+6);

document.getElementById("result").innerHTML=
`ã‚ãªãŸã®å‚åŠ å¯èƒ½é€±ã¯<br>
<span style="font-size:20px;">
${nextMonth}æœˆ${week}é€±ç›®<br>
${formatDate(start)}ã€œ${formatDate(end)}
</span>`;
}

init();
</script>

</body>
</html>
